<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title><%= name %></title><% _.forEach(scripts, function (path) { %>
    <script src="<%= path %>"></script><% }); %>
    <script src="http://cdn.rawgit.com/rtc-io/rtc/v3.1.1/dist/rtc.js"></script>
    <script src="<%= noflo %>"></script>
  </head>
  <body>
    <a id='flowhub_debug_url'>Debug in Flowhub</a>
    <%= content %>
    <script>
      var noflo = require('noflo');
      var runtime = require('noflo-runtime-webrtc');
      noflo.graph.loadJSON(require('<%= graphPath %>'), function (graph) {
        graph.baseDir = '/<%= lib %>';
        var runtimeOptions = {
            defaultGraph: graph,
            baseDir: graph.baseDir
        };
        var rt = runtime(null, runtimeOptions, true);
        rt.signaller = '<%= signalServer %>';
        rt.start();
        var ide = '<%= ideUrl %>';
        var debugUrl = ide+'#runtime/endpoint?'+encodeURIComponent('protocol=webrtc&address='+rt.signaller+'#'+rt.id);
        console.log('Debug URL', debugUrl);
        document.getElementById('flowhub_debug_url').href = debugUrl;
        rt.network.on('addnetwork', function () {
            console.log('<%= name %> is running!');
        });
      });
    </script>
  </body>
</html>
